var tr_delete='';
var replyComment=false;
var addToEdit = function() {
	comment_id = arguments[0];

	if(arguments[1])
		addCommentsUrl = arguments[1];

	var f = '';
	var cmtObj = $Jq("#comment_"+comment_id);
	var ovalue = Trim(cmtObj.val());
	if(ovalue) {
			ovalue = replace_string(ovalue, '\n', '<br />');
	} else {
		cmtObj.val('');
		cmtObj.focus();
		return false;
	}

	var currpath = addCommentsUrl+'&comment_id='+comment_id+'&type=edit&f='+encodeURIComponent(ovalue);
	callAjaxUpdate(currpath,'selCommentBlock');
	return false;
};

function callAjaxUpdate(path, block) {
	new jquery_ajax(path, '', 'callAjaxUpdateResponse');
	return false;
};

function callAjaxUpdateResponse(data) {
	data = unescape(data);
	if(data.indexOf('ERR~')>=1)
	{
		data = data.replace('ERR~','');
		alert_manual(data);
	}
	else
	{
		data = data.split('***--***!!!');
		data[0] = jQuery.trim(data[0])
		if(obj = $Jq('#selEditCommentTxt_'+data[0]).get(0))
			$Jq('#selEditCommentTxt_'+data[0]).html(data[1]);

		discardEdit(data[0]);
	}
	return;
};


function discardReply(coment_block, comment_id){
	$Jq('#'+coment_block).toggle('slow');
	$Jq('#comment_'+comment_id).val('');
};

//Reply comment
var addToReply = function(){
	var comment_id = arguments[0];

	if(arguments[1]){
		if(!dontUse)
			addCommentsUrl = arguments[1];
	}

	var f = '';
	var cmtObj = $Jq("#comment_"+comment_id);
	var ovalue = Trim(cmtObj.val());
	if(ovalue){
		ovalue = replace_string(ovalue, '\n', '<br />');
	}else{
		cmtObj.val('');
		cmtObj.focus();
		return false;
	}

	var currpath = addCommentsUrl+'&comment_id='+comment_id+'&f='+encodeURIComponent(ovalue);
	callAjaxReply(currpath, comment_id);
	return false;
};

function callAjaxReply(path, comment_id){
	var pars = '';
	$Jq.ajax({
		type: "POST",
		url: path,
		data: pars,
		success: function(data){
			if(data.indexOf('ERR~')>=1)
			{
				data = data.replace('ERR~','');
				alert_manual(data);
			}
			else
			{
				$Jq('#selReplyForComments_'+comment_id).html(data);
				$Jq('#selAddComments_'+comment_id).toggle('slow');
				$Jq('#comment_'+comment_id).val('');
				return true;
			}
		}
	 });
	return false;
};

function showReplyToCommentsOption(coment_block){
	$Jq('#'+coment_block).toggle('slow');
}

function callAjaxEdit(path, comment_id) {
	path = path+'&type=edit&comment_id='+comment_id;
	new jquery_ajax(path, '', 'ajaxResultEdit');
	return false;
};

function ajaxResultEdit(data) {
	data = unescape(data);
	if(data) {
		var obj;
		data = jQuery.trim(data);
		data = data.split('***--***!!!');
		var ids=data[0];

		if(data[1].indexOf('ERR~')>=1)
		{
			data[1] = data[1].replace('ERR~','');
			alert_manual(data[1]);
		}
		else
		{
			if(obj = $Jq('#selEditCommentTxt_'+ids).get(0))
				$Jq('#selEditCommentTxt_'+ids).css('display', 'none');

			$Jq('#selEditComments_'+ids).css('display', 'block');
			$Jq('#selViewDeleteComment_'+ids).removeClass('clsDeleteButton');
			$Jq('#selViewDeleteComment_'+ids).addClass('clsReplyButton');

			var txt = replace_string(data[1], '<br>', '\n');
			txt = replace_string(txt, '<br />', '\n');
			txt = jQuery.trim(txt);

			$Jq('#selEditComments_'+ids).html(txt);
			$Jq('#selViewEditComment_'+ids).css('display', 'none');
		}
		return true;
	}
	return false;
};

function discardEdit(comment_id) {
	var obj;
	if(obj = $Jq('#selEditCommentTxt_'+comment_id).get(0))
		$Jq('#selEditCommentTxt_'+comment_id).css('display', 'block');

	if(obj = $Jq('#selEditComments_'+comment_id).get(0))
		$Jq('#selEditComments_'+comment_id).css('display', 'none');

	if(obj = $Jq('#selViewEditComment_'+comment_id).get(0))
		$Jq('#selViewEditComment_'+comment_id).css('display', 'block');
		
		$Jq('#selViewDeleteComment_'+comment_id).removeClass('clsReplyButton');
		$Jq('#selViewDeleteComment_'+comment_id).addClass('clsDeleteButton');
};

var deleteCommandOrReply = function() {
	if ($Jq("#commentorreply").val() == 'deletecomment'){
		deleteCommand();
	} else {
		deleteCommandReply();
	}
};

var deleteCommand = function() {
	var data = $Jq("#msgConfirmform").serialize();
	data = data + '&ajax_page=true&page=deletecomment';
	$Jq.ajax({
		type: "POST",
		url: $Jq("#msgConfirmform").attr('action'),
		data: data,
		beforeSend:displayLoadingImage(),
		success: function(response){
			if(response.indexOf('ERR~')>=1)
			{
				hideAllBlocks();
				response = response.replace('ERR~','');
				alert_manual(response);
			}
			else if(response.indexOf('selLogin') > 0)
			{
				hideAllBlocks();
				document.msgConfirmformMulti1.action = member_login_url;
				if(!Confirmation('selMsgLoginConfirmMulti', 'msgConfirmformMulti1', Array('selAlertLoginMessage'), Array(common_delete_login_err_message), Array('innerHTML')))
				{
					return false;
				}
			}
			else
			{
			 	$Jq("#selCommentBlock").html(response);
			 	$Jq("#total_comments").html(parseInt($Jq("#total_comments").html())-1);
			 	hideAllBlocks();
			 }
		}
	});
	return false;
};

var deleteCommandReply = function() {
	var comment_id = arguments[1];
	var data = $Jq("#msgConfirmform").serialize();
	data = data + '&ajax_page=true&page=deletecommentreply';
	$Jq.ajax({
		type: "POST",
		url: $Jq("#msgConfirmform").attr('action'),
		data: data,
		beforeSend:displayLoadingImage(),
		success: function(response){
			if(response.indexOf('ERR~')>=1)
			{
				hideAllBlocks();
				response = response.replace('ERR~','');
				alert_manual(response);
			}
			else if(response.indexOf('selLogin') > 0)
			{
				hideAllBlocks();
				document.msgConfirmformMulti1.action = member_login_url;
				if(!Confirmation('selMsgLoginConfirmMulti', 'msgConfirmformMulti1', Array('selAlertLoginMessage'), Array(common_delete_login_err_message), Array('innerHTML')))
				{
					return false;
				}
			}
			else
			{
		 		$Jq("#selReplyForComments_"+$Jq("#maincomment_id").val()).html(response);
		 		hideAllBlocks();
		 	}
		}
	});
	return false;
};

function hidedelCommentBlock(){
	hideAllBlocks();
	$Jq('#commentDelSrc').val('');
    $Jq('#commentDelid').val('');
	$Jq('#selDelCommentMsgConfirm').hide();
	$Jq('#comment').val('');
	$Jq('#photo_comment_add_block').css('display', 'none');
	$Jq('#add_comment').css('display', 'block');
	$Jq('#cancel_comment').css('display', 'none');
};

function beforeDeleteResult(data) {
	var obj;
	//ERROR MESSAGES
	$Jq('#selCommentBlock').show();
	$Jq('#selMsgSuccess').show();
	$Jq('#kindaSelMsgSuccess').html(comment_success_deleted_msg);
	$Jq('#selMsgSuccess').fadeOut("slow");
	//CONTENT
	data = unescape(data);
	$Jq('#selCommentBlock').html(data);
	hidedelCommentBlock();
	return false;
};
